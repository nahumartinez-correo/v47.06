/****o* Pendientes de agrupación/OFB:post:MISCfacImp
* NOMBRE
*   OFB:post:MISCfacImp
* DESCRIPCION
*   Comportamiento del objeto (obligatorio)
* ENTRADAS
*   Parámetros de entrada de la rutina, sean argumentos o campos que tiene en cuenta
* SALIDAS
*   Campos modificados como resultado o returns cuyos valores sean no triviales
* IMPACTOS
*   Otros objetos que deberán ser analizados al modificar el objeto actual
* REFERENCIADO POR
*   Objetos que llaman al objeto documentado (obligatorio)
* DOCUMENTACION
*   Documentación relevante que deberá ser actualizada por la modificación de la rutina
* SOURCE
*/
#include "postmisc.h"

SUB post:MISCfacImp()

   /********************************************************************************************************/
   /*                                                                                                      */
   /* [PAW - 22/04/99]      Esta rutina se encarga de analizar el estado de la impresión de la factura     */
   /*                       y según resulte, retomar el proceso en ese punto de ejecución.                 */
   /*                                                                                                      */
   /* Aclaración    :       En caso de no haberse capturado el número, levanta un popup y lo captura.      */
   /*                                                                                                      */
   /********************************************************************************************************/
	local l_retval like lib:err_retval
	local locManual like post:OperacionCob
	
	locManual = FALSE
	
	modoPrt = DOCPR
	if (revTicket != "S")
		/*Si es NC a CM cambio el mensaje - Gabriel Falciola*/
		if (!OperacionNC) then
			call post:PRTfac_nc_gral("¿Fue impresa correctamente la Factura?",OFB_IDNO, OFB_YESNO)
		else
			call post:PRTfac_nc_gral("¿Fue impresa correctamente la Nota de Crédito?",OFB_IDNO, OFB_YESNO)
		end if
	else
		call post:CDSprt_ticket(modoPrt, "¿Fue impreso correctamente el Ticket?",OFB_IDNO, OFB_YESNO)
	endif
	l_retval = retval
	if (l_retval != 0)
		modoPrt = LASER
		retval = 1
		while (retval != 0)
			if (revTicket != "S")
				call post:PRTfac_nc_gral("Desea reimprimir la Factura en la laser?",OFB_IDYES, OFB_YESNO2)
			else
				call post:CDSprt_ticket(LASER, "Desea reimprimir el Ticket en la laser?",OFB_IDYES, OFB_YESNO2)
			endif
		end while
		if (revTicket != "S")
			msgbox "Deberá confeccionar manualmente la Factura.", OFB_OK, "Aviso"
			locManual = TRUE
		else
			msgbox "Deberá confeccionar manualmente el Ticket.", OFB_OK, "Aviso"
		endif
	endif
	if (!locManual)
		call post:MISCImprimoRecCM
		IF (ImprimeAcuseRec)
			call post:DOCSacuse_recibo
		END IF
		if (post:OperacionNC) then
			Call post:DOCSacuse_reciboNC
		end if	
        ;Actualizo las tablas stockp y StockpCDD con el número de factura
        call post:CDSstockp_CDD_up_Fac
		;SC50288 Imprime reportes de rendición de CREM
		call post:DOCSreportesCREM
	end if
	return l_retval
END SUB

/*******/
