/****o* Pendientes de agrupación/OFB:post:CDSverifContSaca
* NOMBRE
*   OFB:post:CDSverifContSaca
* DESCRIPCION
*   Comportamiento del objeto (obligatorio)
* ENTRADAS
*   Parámetros de entrada de la rutina, sean argumentos o campos que tiene en cuenta
* SALIDAS
*   Campos modificados como resultado o returns cuyos valores sean no triviales
* IMPACTOS
*   Otros objetos que deberán ser analizados al modificar el objeto actual
* REFERENCIADO POR
*   Objetos que llaman al objeto documentado (obligatorio)
* DOCUMENTACION
*   Documentación relevante que deberá ser actualizada por la modificación de la rutina
* SOURCE
*/
#include "postcds.h"

SUB post:CDSverifContSaca
/* Verifica que si una pieza esta en un contenedor que se   */
/* envio en una saca, la transaccion de la pieza no se pueda*/
/* reversar -                                               */
/* May. 1998 - B. Petrella -                                */

swapdup siaf:jnl_codigo_siaf
swapdup post:jnl_guia_saca
let siaf:jnl_codigo_siaf = "99030"

  CDS SELECT FROM DSC:tlr:TABjnl BECOMES DSC:tlr:jnl_context WHERE \
    (tlr:jnl_operator == op:op_operator_id && \
    siaf:jnl_codigo_siaf == siaf:jnl_codigo_siaf && \
    post:jnl_guia_cont == post:jnl_guia_cont)

  CDS FINDFIRST DSC:tlr:jnl_context LOCK

  IF (CDSRETVAL != 0) THEN
    swapdup siaf:jnl_codigo_siaf
    swapdup post:jnl_guia_saca
    CDS UNLOCK DSC:tlr:jnl_context
    CDS ENDSELECT DSC:tlr:jnl_context
    RETURN (-1)
  END IF
  CDS EXTRACT DSC:tlr:jnl_context post:jnl_guia_saca jnl_guia_despacho
  swapdup post:track_trace //Linea Nueva
  if (post:jnl_guia_saca.numchars > 0 || post:jnl_guia_despacho.NUMCHARS > 0) THEN
    swapdup siaf:jnl_codigo_siaf
    swapdup post:jnl_guia_saca
    CDS UNLOCK DSC:tlr:jnl_context
    CDS ENDSELECT DSC:tlr:jnl_context
    RETURN (-2)
  end if
  /*MFM - Pido supervision*/
  CLEARFIELD siaf:cartel
  let siaf:afecta_efectivo = " "
  SETFLAG  tlr:tran_flags, supovr_request
  SETFLAG  siaf:siaf_flags, req_tes
  SETFLAG  siaf:siaf_flags, req_sup1
  CALL siaf:MISCovr_process
  IF (RETVAL < 0)THEN
    RESETFLAG  tlr:tran_flags, supovr_request
    RESETFLAG  siaf:siaf_flags, req_tes
    RESETFLAG  siaf:siaf_flags, req_sup1
      RETURN (-3)
  END IF
  INIT 33,0

  /*MFM - Borro los scaneos correspondientes de la tabla de Novedades TT*/
  CALL CDSBorro_Scaneos ("C")

  swapdup siaf:jnl_codigo_siaf
  swapdup post:jnl_guia_saca

  CDS UNLOCK DSC:tlr:jnl_context
  CDS ENDSELECT DSC:tlr:jnl_context
END SUB

/*******/
