/****o* Pendientes de agrupación/OFB:tlr:tlr_fb9_real
* NOMBRE
*   OFB:tlr:tlr_fb9_real
* DESCRIPCION
*   Comportamiento del objeto (obligatorio)
* ENTRADAS
*   Parámetros de entrada de la rutina, sean argumentos o campos que tiene en cuenta
* SALIDAS
*   Campos modificados como resultado o returns cuyos valores sean no triviales
* IMPACTOS
*   Otros objetos que deberán ser analizados al modificar el objeto actual
* REFERENCIADO POR
*   Objetos que llaman al objeto documentado (obligatorio)
* DOCUMENTACION
*   Documentación relevante que deberá ser actualizada por la modificación de la rutina
* SOURCE
*/
#include "mainkeys.h"

SUB tlr:tlr_fb9_real
	LOCAL siaf_temp LIKE siaf:codigo_siaf

#if CORREO_DEBUG == CORREO_ON
	;if (plataf:current_state == CONFIRMATION) then
	call post:MISClogMenues("tlr:tlr_fb9_real")
	;endif
#endif

	let drv:last_button = TFB9
	CALL  tlr:check_enabled
	if ( retval != 0 )
    		return
	END IF
	let drv:button = TFB9
	CALL  drv:but_down_disable
	if (tlr:f10button == "F10 Firmantes") then
		CALL tlr:KEYSver_documentos
	else
            IF (post:tipo_transac == "CSP" && post:estado_presu == "2") THEN
		    /**********************************************************/
		    /* Incorporado por Juan Pablo para que  dentro de las Transacciones */
		    /* Postales el F10 actue como un DUPFIELD ALL    				*/
		    /**********************************************************/
            		siaf_temp = siaf:codigo_siaf
            		SWAPDUP siaf:codigo_siaf
            		IF (siaf_temp == siaf:codigo_siaf) THEN
                   		/********************************************************/
            	    		/* Caso 1 : Estoy adentro de una Transacción, pulso F10 y  era la 	*/
            	    		/* misma Transacción que la anterior. Duplico todos los campos. 	*/
            	    		/* Esto no funciona si ya se 	había pulsado F10 desde el Menú para*/
            	    		/* llamar automáticamente a la Transacción actual (Caso 4).		*/
                    	/*********************************************************/
                    	DUPFIELD ALL
                    	CALL CSR:proc_list(F_REFRESH,LST:post:LISTgral_refresh)
            		ELSE
            			/********************************************************/
            	    		/* Caso 2 : Estoy adentro de una Transacción, pulso F10 y  no era 	*/
            	    		/* la misma Transacción que la anterior. Duplico solo el campo 	*/
            	    		/* sobre el que estoy parado.								*/
            			/********************************************************/
                   		siaf:codigo_siaf = siaf_temp
                    	CALL KEYSdup
            		END IF
            ELSE
			/************************************************************/
                	/* Caso 3 : Estoy dentro de una Transacción Rápida, pulso F10, se 		*/
                	/* repite el valor del campo que tenía en la Transacción anterior.  (OK)	*/
                	/* Caso 4 : Estando en el Menú pulso F10 y si la anterior Transacción 	*/
                	/* era Rápida, la vuelve a ejecutar.          							*/
                	/************************************************************/
                	CALL post:CDSadt_presuact_load
                	IF (post:adt_Modo != "NR") THEN
                		/* La Transacción anterior era Rápida */
                		/* No hago nada por ahora */
                  	 ELSE
                	 	IF (post:PreDNroTrn > 0) THEN
                	 		/********************************************/
                	      		/* Estoy en Sesión y no es la primer Transacción 	*/
                	      		/* por lo que repito la transacción anterior.			*/
                	      		/********************************************/
                	            	CALL KEYSdup
                		END IF
                	END IF
            	END IF
	end if
	let drv:button = TFB9
	CALL  drv:but_up_enable
END SUB

/*******/
